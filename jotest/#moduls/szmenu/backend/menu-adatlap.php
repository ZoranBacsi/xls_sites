<?php /* Készítő: H.Tibor */ if(!($_ENV['SiteStart']) OR !($_ENV['USER']['ss_aid']>0)) { header('HTTP/1.0 404 Not Found',$replace=false,404); header('Location: /'); exit(); }	if($_REQUEST['rogzit'] AND strlen($_REQUEST['szm_link'])>2) {		if(is_array($_REQUEST['szm_private_kategs'])) { $_REQUEST['szm_private_kategs'] = join('|',$_REQUEST['szm_private_kategs']); }		if($_REQUEST['szm_mod']=='L') { $_REQUEST['szm_reurl']='#'; }		if($_REQUEST['szmid']>0) {			if(mysqli_query($_ENV['MYSQLI'],'				UPDATE `szmenu` SET					`szm_private_kategs`="'.(in_text($_REQUEST['szm_private_kategs'])).'",					`szm_gal`="'.(in_text($_REQUEST['szm_gal'])).'",					`szm_public`="'.(in_text($_REQUEST['szm_public'])).'",					`szm_link`="'.(in_text($_REQUEST['szm_link'])).'",					`szm_reurl`="'.(in_text($_REQUEST['szm_reurl'])).'",					`szm_status`="'.(in_text($_REQUEST['szm_status'])).'",					`szm_tipus`="'.(in_text($_REQUEST['szm_tipus'])).'",					`szm_mod`="'.(in_text($_REQUEST['szm_mod'])).'",					`szm_href`="'.(in_text($_REQUEST['szm_href'])).'",					`szm_target`="'.(in_text($_REQUEST['szm_target'])).'",					`szm_cim`="'.(in_text($_REQUEST['szm_cim'])).'",					`szm_index`="'.(in_text($_REQUEST['szm_index'])).'",					`szm_h1`="'.(in_text($_REQUEST['szm_h1'])).'",					`szm_title`="'.(in_text($_REQUEST['szm_title'])).'",					`szm_keyw`="'.(in_text($_REQUEST['szm_keyw'])).'",					`szm_desc`="'.(in_text($_REQUEST['szm_desc'])).'",					`szm_text`="'.(in_html($_REQUEST['szm_text'])).'"				WHERE `szm_id`="'.($_REQUEST['szmid']).'" LIMIT 1')) {					echo'<script type="text/javascript">AddAlert("ok","Menüpont sikeresen módosítva!");</script>';				} else {					echo'<script type="text/javascript">AddAlert("no","Menüpont módosítása sikertelen!");</script>';				}		} else {			$con=mysqli_query($_ENV['MYSQLI'],'SELECT count(*) as max FROM `szmenu` WHERE `szm_k_id`="'.($_REQUEST['p_id']).'"');			$sor=mysqli_fetch_array($con,MYSQLI_ASSOC); $uj_sorsz = ($sor['max'] + 1);			mysqli_query($_ENV['MYSQLI'],'				INSERT INTO `szmenu`					( `szm_private_kategs`, `szm_gal`, `szm_auid`, `szm_k_id`, `szm_level`, `szm_sorsz`, `szm_public`, `szm_tipus`, `szm_mod`, `szm_status`, `szm_reurl`, `szm_link`, `szm_href`, `szm_target`, `szm_cim`, `szm_index`, `szm_h1`, `szm_title`, `szm_keyw`, `szm_desc`, `szm_text`, `szm_date` )				VALUES					(						"'.(in_text($_REQUEST['szm_private_kategs'])).'",						"'.(in_text($_REQUEST['szm_gal'])).'",						"'.(in_text($_ENV['USER']['a_id'])).'",						"'.(in_text($_REQUEST['p_id'])).'",						"'.(in_text($_REQUEST['level'])).'",						"'.(in_text($uj_sorsz)).'",						"'.(in_text($_REQUEST['szm_public'])).'",						"'.(in_text($_REQUEST['szm_tipus'])).'",						"'.(in_text($_REQUEST['szm_mod'])).'",						"'.(in_text($_REQUEST['szm_status'])).'",						"'.(in_text($_REQUEST['szm_reurl'])).'",						"'.(in_text($_REQUEST['szm_link'])).'",						"'.(in_text($_REQUEST['szm_href'])).'",						"'.(in_text($_REQUEST['szm_target'])).'",						"'.(in_text($_REQUEST['szm_cim'])).'",						"'.(in_text($_REQUEST['szm_index'])).'",						"'.(in_text($_REQUEST['szm_h1'])).'",						"'.(in_text($_REQUEST['szm_title'])).'",						"'.(in_text($_REQUEST['szm_keyw'])).'",						"'.(in_text($_REQUEST['szm_desc'])).'",						"'.(in_html($_REQUEST['szm_text'])).'",						now()					)');			$_REQUEST['szmid'] = mysqli_insert_id($_ENV['MYSQLI']);			if($_REQUEST['szmid']>0) {				echo'<script type="text/javascript">AddAlert("ok","Menüpont sikeresen létrehozva!");</script>';			} else {				echo'<script type="text/javascript">AddAlert("no","Menüpont létrehozása meghiúsult!");</script>';			}		}		if($_REQUEST['szmid']>0) {			KepUP::Load('szm_{'.($_REQUEST['szmid']).'}');			$con = mysqli_query($_ENV['MYSQLI'],'SELECT `ru_id` FROM `reurl` WHERE `ru_modul`="'.($_ENV['SITE']['MODUL']).'" AND `ru_elem_id`="szm_{'.($_REQUEST['szmid']).'}" LIMIT 1');			if(mysqli_num_rows($con)>0) {				mysqli_query($_ENV['MYSQLI'],'					UPDATE `reurl` SET						`ru_reurl`="'.(in_text($_REQUEST['szm_reurl'])).'",						`ru_index`="'.(in_text($_REQUEST['szm_index'])).'",						`ru_status`="'.(in_text($_REQUEST['szm_status'])).'",						`ru_h1`="'.(in_text($_REQUEST['szm_h1'])).'",						`ru_title`="'.(in_text($_REQUEST['szm_title'])).'",						`ru_keyw`="'.(in_text($_REQUEST['szm_keyw'])).'",						`ru_desc`="'.(in_text($_REQUEST['szm_desc'])).'",						`ru_date`=now()					WHERE `ru_modul`="'.($_ENV['SITE']['MODUL']).'" AND `ru_elem_id`="szm_{'.($_REQUEST['szmid']).'}" LIMIT 1');			} else {				mysqli_query($_ENV['MYSQLI'],'					INSERT INTO `reurl`						( `ru_modul`, `ru_elem_id`, `ru_reurl`, `ru_index`, `ru_status`, `ru_h1`, `ru_title`, `ru_keyw`, `ru_desc`, `ru_date` )					VALUES						(							"'.($_ENV['SITE']['MODUL']).'",							"szm_{'.($_REQUEST['szmid']).'}",							"'.(in_text($_REQUEST['szm_reurl'])).'",							"'.(in_text($_REQUEST['szm_index'])).'",							"'.(in_text($_REQUEST['szm_status'])).'",							"'.(in_text($_REQUEST['szm_h1'])).'",							"'.(in_text($_REQUEST['szm_title'])).'",							"'.(in_text($_REQUEST['szm_keyw'])).'",							"'.(in_text($_REQUEST['szm_desc'])).'",							now()						)');			}		}		print(mysqli_error($_ENV['MYSQLI']));	}	if($_REQUEST['szmid']>0) {		$con = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `szmenu` WHERE `szm_id`="'.($_REQUEST['szmid']).'" LIMIT 1');		$sor = mysqli_fetch_array($con,MYSQLI_ASSOC);		echo'			<h1 class="cim">'.($sor['szm_link']).' {szm_menupont_szerkesztese}!</h1>';	} else {		echo'			<h1 class="cim">{szm_menupont_szerkesztese_cim}!</h1>';	}	xPozicio($_REQUEST['p_id'],$_REQUEST['oldal'],$_REQUEST['mode']);	echo'			<a class="new_link" href="?oldal='.($_REQUEST['oldal']).'&amp;mode='.($_REQUEST['mode']).'&amp;p_id='.($_REQUEST['p_id']).'&amp;level='.($_REQUEST['level']).'">&#171; {vissza}</a><br/><br/>';	echo'			<form action="?oldal='.($_REQUEST['oldal']).'" method="post" name="iForm" id="iForm" onsubmit="return FormControl(1);" ENCTYPE="multipart/form-data">				<div style="text-align:right;"><input class="admin_btn save_btn" name="smbt" type="submit" value="'.(($_REQUEST['szmid']>0)?('{modosit}'):('{felvisz}')).'" style="float:none;margin: -25px 0px 10px;" onclick="$(\'#MyBody\').attr(\'edited\',null);" /></div>				<input type="hidden" name="rogzit" value="1"/>				<input type="hidden" name="mode" value="'.($_REQUEST['mode']).'" />				<input type="hidden" name="xMode" value="'.($_REQUEST['xMode']).'" />				<input type="hidden" name="p_id" value="'.($_REQUEST['p_id']).'" />				<input type="hidden" name="level" value="'.($_REQUEST['level']).'" />				<input type="hidden" name="szmid" value="'.($_REQUEST['szmid']).'" />				<input type="hidden" id="FixReurl" value="'.(($_REQUEST['szmid']>0)?(1):(0)).'" />				<table class="table" width="100%" cellspacing="0" cellpadding="3" border="0">					<tbody>						<tr class="fejlec"> <th colspan="2"> {szm_menupont_szerkesztese} </th> </tr>						<tr>							<td class="cimke" style="width:150px;"><label for="szm_link"><b>{szm_link}:</b></label></td>							<td>								<input type="text" id="szm_link" name="szm_link" value="'.($sor['szm_link']).'" class="typeText required" minlength="3" maxlength="255" copyReurl="szm_reurl" />								<div class="helpBox">{szm_link_info}</div>							</td>						</tr>						<tr class="modeMenu" style="display:'.(($sor['szm_mod']=='L')?('none'):('')).'">							<td class="cimke"><label for="szm_reurl"><b>{rovid_url}:</b></label></td>							<td>								<input type="text" id="szm_reurl" name="szm_reurl" value="'.($sor['szm_reurl']).'" class="typeReURL required" minlength="3" maxlength="255" reurl="szmenu,'.(($_REQUEST['szmid']>0)?($_REQUEST['szmid']):(0)).','.(($_REQUEST['p_id']>0)?($_REQUEST['p_id']):(0)).'" />								<div class="helpBox">{rovid_url_info}</div>							</td>						</tr>						<tr class="modeMenu" style="display:'.(($sor['szm_mod']=='L')?('none'):('')).'">							<td class="cimke"><label for="szm_h1"><b>{h1}</b></label></td>							<td>								<input type="text" id="szm_h1" name="szm_h1" value="'.($sor['szm_h1']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{h1_info}</div>							</td>						<tr class="modeMenu" style="display:'.(($sor['szm_mod']=='L')?('none'):('')).'">							<td class="cimke"><label for="szm_title"><b>{title}</b></label></td>							<td>								<input type="text" id="szm_title" name="szm_title" value="'.($sor['szm_title']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{title_info}</div>							</td>						</tr>						<tr class="modeMenu" style="display:'.(($sor['szm_mod']=='L')?('none'):('')).'">							<td class="cimke"><label for="szm_keyw"><b>{keywords}:</b></label></td>							<td>								<input type="text" id="szm_keyw" name="szm_keyw" value="'.($sor['szm_keyw']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{keywords_info}</div>							</td>						</tr>						<tr class="modeMenu" style="display:'.(($sor['szm_mod']=='L')?('none'):('')).'">							<td class="cimke"><label for="szm_desc"><b>{description}:</b></label></td>							<td>								<input type="text" id="szm_desc" name="szm_desc" value="'.($sor['szm_desc']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{description_info}</div>							</td>						</tr>						<tr class="modeMenu" style="display:'.(($sor['szm_mod']=='L')?('none'):('')).'">							<td><label for="szm_index"><b>{indexel}:</b></label></td>							<td>								<select id="szm_index" name="szm_index">									<option value="I"'.(($sor['szm_index']=='I')?(' SELECTED'):('')).'>Igen</option>									<option value="N"'.(($sor['szm_index']=='N')?(' SELECTED'):('')).'>Nem</option>								</select>								<div class="helpBox">{indexel_info}</div>							</td>						</tr>						<tr>							<td><label for="szm_status"><b>{statusz}:</b></label></td>							<td>								<select id="szm_status" name="szm_status">									<option value="A"'.(($sor['szm_status']=='A')?(' SELECTED'):('')).'>{aktiv}</option>									<option value="I"'.(($sor['szm_status']=='I')?(' SELECTED'):('')).'>{inaktiv}</option>								</select>								<div class="helpBox">{statusz_info}</div>							</td>						</tr>		'.(($_ENV['SzmenuKulsoURL'])?('						<tr>							<td><label for="szm_mod"><b>{szm_menu_tipusa}:</b></label></td>							<td>								<select id="szm_mod" name="szm_mod" onchange="ModSelect(this.value)">									<option value="M"'.(($sor['szm_mod']=='M')?(' SELECTED'):('')).'>{szm_menu_tipusa_menu}</option>									'.(($_ENV['SzmenuKulsoURL'])?('<option value="L"'.(($sor['szm_mod']=='L')?(' SELECTED'):('')).'>{szm_menu_tipusa_kulsourl}</option>'):('')).'								</select>								<div class="helpBox">{szm_menu_tipusa_info}'.(($_ENV['SzmenuKulsoURL'])?('{szm_menu_tipusa_info_kulsourl}'):('')).'</div>							</td>						</tr>'):('<tr style="display:none;"><td colspan="2"><input type="hidden" name="szm_mod" value="M" /></td></tr>')).'		'.(($_ENV['SzmenuType'] AND $_ENV['SzmenuMaxLevel']>1 AND $_ENV['SzmenuMaxLevel']>$_REQUEST['level'])?('						<tr class="modeMenu modMenuType" style="display:'.(($sor['szm_mod']=='M' OR $sor['szm_mod']=='')?(''):('none')).'">							<td><label for="szm_tipus"><b>{szm_almenu_type}:</b></label></td>							<td>								<select id="szm_tipus" name="szm_tipus">									<option value="N"'.(($sor['szm_tipus']=='N')?(' SELECTED'):('')).'>{szm_almenu_type_no_list}</option>									<option value="S"'.(($sor['szm_tipus']=='S')?(' SELECTED'):('')).'>{szm_almenu_type_jsmenu}</option>									<option value="M"'.(($sor['szm_tipus']=='M')?(' SELECTED'):('')).'>{szm_almenu_type_menu}</option>									<option value="L"'.(($sor['szm_tipus']=='L')?(' SELECTED'):('')).'>{szm_almenu_type_list}</option>									<option value="R"'.(($sor['szm_tipus']=='R')?(' SELECTED'):('')).'>{szm_almenu_type_rovid}</option>									<option value="T"'.(($sor['szm_tipus']=='T')?(' SELECTED'):('')).'>{szm_almenu_type_tartalomjegyzek}</option>								</select>								<div class="helpBox">{szm_almenu_type_info}</div>							</td>						</tr>'):('<tr id="tr_tipus" style="display:none;"><td colspan="2"><input type="hidden" name="szm_tipus" value="N" /></td></tr>'));	if($_ENV['SzmenuGalTarsit']) {		echo'						<tr class="modeMenu" style="display:'.(($sor['szm_mod']=='L')?('none'):('')).'">							<td class="cimke"><label for="szm_gal"><b>{szm_galeria}:</b></label></td>							<td>								<select name="szm_gal" id="szm_gal">									<option value=""> -- {szm_galeriak} -- </option>';		$gcon = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `galeria` WHERE `gal_status`="A" ORDER BY `gal_sorsz`');		while($gsor=mysqli_fetch_array($gcon,MYSQLI_ASSOC)) {			echo'									<option value="'.($gsor['gal_id']).'"'.(($gsor['gal_id']==$sor['szm_gal'])?(' SELECTED'):('')).'> '.($gsor['gal_cim']).' </option>';		}		echo'								</select>							</td>						</tr>';	}	echo'					'.((!(count($_ENV['uGroups'])>0) AND is_array($_ENV['WEBUSERS']) AND $_ENV['SzmenuRegKot'])?('						<tr class="modeMenu">							<td><label for="szm_public"><b>{szm_regkot}:</b></label></td>							<td>								<select id="szm_public" name="szm_public">									<option value="N"'.(($sor['szm_public']=='N')?(' SELECTED'):('')).'>{nem}</option>									<option value="I"'.(($sor['szm_public']=='I')?(' SELECTED'):('')).'>{igen}</option>								</select>								<div class="helpBox">{szm_regkot_info}</div>							</td>						</tr>'):('<tr style="display:none;"><td colspan="2"><input type="hidden" name="szm_public" value="N"/></td></tr>'));						if(count($_ENV['uGroups'])>0 AND (is_array($_ENV['WEBUSERS']) AND $_ENV['SzmenuRegKot'])) {		echo'						<tr class="modeMenu" style="display:'.(($sor['szm_mod']=='L')?('none'):('')).'">							<td><label><b>Engedélyezett csoportok:</b></label></td>							<td>';		if(!is_array($sor['szm_private_kategs'])) { $sor['szm_private_kategs'] = explode('|',$sor['szm_private_kategs']); }		for($a=1;$a<=count($_ENV['uGroups']);$a++) {			echo'				<div>					<input type="checkbox" class="checkbox" id="uw_grouops_'.($a).'" name="szm_private_kategs[]" value="'.($a).'" '.((in_array($a,$sor['szm_private_kategs']))?('checked'):('')).' />					<label for="uw_grouops_'.($a).'">'.($_ENV['uGroups'][$a]).'</label>				</div>';		}		echo'							</td>						</tr>';	}echo'						<tr class="modeMenu" style="display:'.(($sor['szm_mod']=='L')?('none'):('')).'">							<td class="cimke"><label for="szm_cim"><b>{cime}:</b></label></td>							<td>								<input type="text" id="szm_cim" name="szm_cim" value="'.($sor['szm_cim']).'" class="typeText" minlength="3" maxlength="128" />								<div class="helpBox">{cime_info}</div>							</td>						</tr>						<tr class="modeLink" style="display:'.(($sor['szm_mod']=='L')?(''):('none')).';">							<td class="cimke"><label for="szm_href"><b>{szm_kulsourl}:</b></label></td>							<td>								<input type="text" id="szm_href" name="szm_href" value="'.($sor['szm_href']).'" class="typeText" minlength="3" maxlength="5000" />								<div class="helpBox">{szm_kulsourl_info}</div>							</td>						</tr>						<tr class="modeLink" style="display:'.(($sor['szm_mod']=='L')?(''):('none')).'">							<td>&nbsp;</td>							<td>								<label for="szm_target">									<input class="checkbox" type="checkbox" id="szm_target" name="szm_target" value="1"'.(($sor['szm_target']==1)?(' CHECKED'):('')).'/>									<b>{szm_kulsourl_target}</b>								</label>								<div class="helpBox">{szm_kulsourl_target_info}</div>							</td>						</tr>												<tr class="modeMenu" style="display:'.(($sor['szm_mod']=='L')?('none'):('')).'">							<td colspan="2" style="padding-top:10px;">								<label for="szm_text"><b>{szm_text}:</b></label>								'.(htmlTextaInsert('szm_text')).'								'.(HTML_TEXTAREA('szm_text',false,false)).'								<div class="helpBox">{szm_text_info}</div><br/>								<textarea class="szm_text tinymce" id="szm_text" name="szm_text" cols="10" rows="10" style="min-width:675px; min-height:500px;">'.($sor['szm_text']).'</textarea>							</td>						</tr>						<tbody class="modeMenuKep">'.(KepUP::AdminForm('szm_{'.(($sor['szm_id'])?($sor['szm_id']):(0)).'}',(($_ENV['SzmenuMenuKep'])?(1):(0)),false,false,false)).'</tbody>						<tr class="fejlec"><td colspan="2" style="text-align: center;"><input class="admin_btn" name="smbt" type="submit" value="'.(($_REQUEST['szmid']>0)?('{modosit}'):('{felvisz}')).'" onclick="$(\'#MyBody\').attr(\'edited\',null);" /></td></tr>					</tbody>				</table>			</form>			<script type="text/javascript">				function FormControl(xa) {					var hibastr="";					var eMod = $("#szm_mod",$("#iForm"));					var eLink = InputControl($("#szm_link",$("#iForm")));					var eReurl = InputControl($("#szm_reurl",$("#iForm")),true);					var eHref = InputControl($("#szm_href",$("#iForm")));					var eH1 = InputControl($("#szm_h1",$("#iForm")));					var eTitle = InputControl($("#szm_title",$("#iForm")));					var eKeyw = InputControl($("#szm_keyw",$("#iForm")));					var eDesc = InputControl($("#szm_desc",$("#iForm")));					var eKep = (($("img[uploading=\'true\']").length>0)?(0):(1));										if(!eLink) { hibastr +="\n{szm_link_error}"; }					if(eMod.val()!="L" && !eReurl) { hibastr +="\n{rovid_url_error}!"; }					if(eMod.val()!="L" && !eH1) { hibastr +="\n{h1_error}!"; }					if(eMod.val()!="L" && !eTitle) { hibastr +="\n{title_error}!"; }					if(eMod.val()!="L" && !eKeyw) { hibastr +="\n{keywords_error}!"; }					if(eMod.val()=="L" && !eDesc) { hibastr +="\n{szm_kulsourl_error}!"; }					if(eMod.val()=="L" && !eHref) { hibastr +="\n{description_error}!"; }					if(!eKep) { hibastr +="\n{kepupload_error}!"; }										if(xa>0) {						if(hibastr!="") {							AddAlert("alert","{formhibak}:"+hibastr);							//alert("{formhibak}:"+hibastr);							return false;						} else { $("#MyBody").attr("edited",null); return true; }					} else { return false; }				}				onReadyDoc(function() { setTimeout("FormControl(0);", 10); });				function ModSelect(mod) {					if(mod=="M") {						$(".modeMenu").css({"display":"table-row"});						$(".modeMenuKep").css({"display":NULL});						$(".modeLink").css({"display":"none"});					} else if(mod=="L") {						$(".modeMenu").css({"display":"none"});						$(".modeMenuKep").css({"display":"none"});						$(".modeLink").css({"display":"table-row"});					}					'.(($_ENV['SzmenuType'] AND $_ENV['SzmenuMaxLevel']>1 AND $_ENV['SzmenuMaxLevel']>$_REQUEST['level'])?('$(".modMenuType").css({"display":"none"});'):('')).'				}			</script>';?>