<?php /* Készítő: H.Tibor */ if(!($_ENV['SiteStart']) OR !($_ENV['USER']['ss_aid']>0)) { header('HTTP/1.0 404 Not Found',$replace=false,404); header('Location: /'); exit(); }		$_ENV['CONF']['sysKeprNagyWidth'] = $_ENV['CONF']['galKepNagyWidth'];		$_ENV['CONF']['sysKeprNagyHeight'] = $_ENV['CONF']['galKepNagyHeight'];		$_ENV['CONF']['sysKeprKozepesWidth'] = $_ENV['CONF']['galKepKozepesWidth'];		$_ENV['CONF']['sysKeprKozepesHeight'] = $_ENV['CONF']['galKepKozepesHeight'];		if($_REQUEST['rogzit']>0) {			if($_REQUEST['galid']>0) {				if(mysqli_query($_ENV['MYSQLI'],'					UPDATE `galeria` SET						`gal_status`="'.(in_text($_REQUEST['gal_status'])).'",						`gal_reurl`="'.(utf8urldecode(in_text($_REQUEST['gal_reurl']))).'",						`gal_defkep`="'.(in_text($_REQUEST['defkep'])).'",						`gal_cim`="'.(in_text($_REQUEST['gal_cim'])).'",						`gal_cim_en`="'.(in_text($_REQUEST['gal_cim_en'])).'",						`gal_cim_de`="'.(in_text($_REQUEST['gal_cim_de'])).'",						`gal_title`="'.(in_text($_REQUEST['gal_title'])).'",						`gal_keyw`="'.(in_text($_REQUEST['gal_keyw'])).'",						`gal_desc`="'.(in_text($_REQUEST['gal_desc'])).'",						`gal_text`="'.(in_html($_REQUEST['gal_text'])).'",						`gal_date`=now()					WHERE `gal_id`="'.($_REQUEST['galid']).'" LIMIT 1')) {					echo'<script type="text/javascript">AddAlert("ok","Album sikeresen módosítva!");</script>';				} else {					echo'<script type="text/javascript">AddAlert("no","Album módosítása sikertelen!");</script>';				}			} else {				$con=mysqli_query($_ENV['MYSQLI'],'SELECT count(*) as max FROM `galeria` WHERE `gal_p_id`="'.(in_text($_REQUEST['kipid'])).'"');				$sor=mysqli_fetch_array($con,MYSQLI_ASSOC); $uj_sorsz = ($sor['max'] + 1);				mysqli_query($_ENV['MYSQLI'],'					INSERT INTO `galeria`						( `gal_p_id`, `gal_level`, `gal_sorsz`, `gal_status`, `gal_reurl`, `gal_defkep`, `gal_cim`, `gal_cim_en`, `gal_cim_de`, `gal_title`, `gal_keyw`, `gal_desc`, `gal_text`, `gal_date` )					VALUES						(							"'.(in_text($_REQUEST['kipid'])).'",							"'.(in_text($_REQUEST['level'])).'",							"'.(in_text($uj_sorsz)).'",							"'.(in_text($_REQUEST['gal_status'])).'",							"'.(utf8urldecode(in_text($_REQUEST['gal_reurl']))).'",							"'.(in_text($_REQUEST['defkep'])).'",							"'.(in_text($_REQUEST['gal_cim'])).'",							"'.(in_text($_REQUEST['gal_cim_en'])).'",							"'.(in_text($_REQUEST['gal_cim_de'])).'",							"'.(in_text($_REQUEST['gal_title'])).'",							"'.(in_text($_REQUEST['gal_keyw'])).'",							"'.(in_text($_REQUEST['gal_desc'])).'",							"'.(in_html($_REQUEST['gal_text'])).'",							now()						)');				$_REQUEST['galid'] = mysqli_insert_id($_ENV['MYSQLI']);				if($_REQUEST['galid']>0) {					echo'<script type="text/javascript">AddAlert("ok","Album sikeresen létrehozva!");</script>';				} else {					echo'<script type="text/javascript">AddAlert("no","Album létrehozása meghiúsult!");</script>';				}			}			if($_REQUEST['galid']>0) {				KepUP::Load('gal_{'.($_REQUEST['galid']).'}');				$con = mysqli_query($_ENV['MYSQLI'],'					SELECT * FROM `reurl` WHERE `ru_modul`="'.($_ENV['SITE']['MODUL']).'" AND `ru_elem_id`="gal_{'.($_REQUEST['galid']).'}" LIMIT 1');				if(mysqli_num_rows($con)>0) {					mysqli_query($_ENV['MYSQLI'],'						UPDATE `reurl` SET							`ru_reurl`="'.(utf8urldecode(in_text($_REQUEST['gal_reurl']))).'",							`ru_h1`="'.(in_text($_REQUEST['gal_h1'])).'",							`ru_title`="'.(in_text($_REQUEST['gal_title'])).'",							`ru_keyw`="'.(in_text($_REQUEST['gal_keyw'])).'",							`ru_desc`="'.(in_text($_REQUEST['gal_desc'])).'"						WHERE `ru_modul`="'.($_ENV['SITE']['MODUL']).'" AND `ru_elem_id`="gal_{'.($_REQUEST['galid']).'}" LIMIT 1');				} else {					mysqli_query($_ENV['MYSQLI'],'						INSERT INTO `reurl`							( `ru_modul`, `ru_elem_id`, `ru_reurl`, `ru_h1`, `ru_title`, `ru_keyw`, `ru_desc` )						VALUES							(								"'.($_ENV['SITE']['MODUL']).'",								"gal_{'.($_REQUEST['galid']).'}",								"'.(utf8urldecode(in_text($_REQUEST['gal_reurl']))).'",								"'.(in_text($_REQUEST['gal_h1'])).'",								"'.(in_text($_REQUEST['gal_title'])).'",								"'.(in_text($_REQUEST['gal_keyw'])).'",								"'.(in_text($_REQUEST['gal_desc'])).'"							)');				}			}		}	echo'				<h1>{gal_galeria_cim}</h1>				<div class="pozicio"><a class="new_link" href="?oldal='.($_REQUEST['oldal']).'">{gal_galeria_poz} &#187;</a> '.(status($_REQUEST['kipid'])).'</div>';		if($_REQUEST['galid']>0) {			$con = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `galeria` WHERE `gal_id`="'.($_REQUEST['galid']).'" LIMIT 1');			$sor = mysqli_fetch_array($con,MYSQLI_ASSOC);			$_ENV['DEFKEP'] = $sor['gal_defkep'];		} else { $sor = $_REQUEST; }		echo'			<a class="new_link" href="?oldal='.($_REQUEST['oldal']).'&kipid='.($_REQUEST['kipid']).'&level='.($_REQUEST['level']).'">&#171; {vissza}</a><br><br>			<form action="?oldal='.($_REQUEST['oldal']).'" method="POST" name="iForm" id="iForm" onsubmit="return FormControl(1);" ENCTYPE="multipart/form-data">				<div style="text-align:right;"><input class="admin_btn save_btn" name="smbt" type="submit" value="'.(($_REQUEST['galid']>0)?('{modosit}'):('{felvisz}')).'" style="float:none;margin: -25px 0px 10px;" onclick="$(\'#MyBody\').attr(\'edited\',null);" /></div>				<input type="hidden" name="rogzit" value="1" />				<input type="hidden" name="kipid" value="'.($_REQUEST['kipid']).'" />				<input type="hidden" name="level" value="'.($_REQUEST['level']).'" />				<input type="hidden" name="xMode" value="'.($_REQUEST['xMode']).'" />				<input type="hidden" name="galid" value="'.($_REQUEST['galid']).'" />				<input type="hidden" id="FixReurl" value="'.(($_REQUEST['galid']>0)?(1):(0)).'">				<table class="table" width="100%" cellspacing="0" cellpadding="3" align="center" border="0">					<tbody>						<tr class="fejlec">							<th colspan="2">'.(($_REQUEST['galid']>0)?('"'.out_text($sor['gal_cim']).'" {gal_szerkesztese}'):('{gal_uj_keszitese}')).'</th>						</tr>						<tr>							<td><b>{gal_neve}:</b></td>							<td>								<input type="text" id="gal_cim" name="gal_cim" value="'.($sor['gal_cim']).'" class="typeText required" minlength="3" maxlength="128" copyReurl="gal_reurl" />								<div class="helpBox">{gal_neve_info}</div>							</td>						</tr>';	if(count($_ENV['LANG']['ENABLED_LANG'])>1) {		for($b=0;$b<count($_ENV['LANG']['ENABLED_LANG']);$b++) {			$_lang = strtolower($_ENV['LANG']['ENABLED_LANG'][$b]);			if($_lang AND $_lang!='hu') {				echo '						<tr>							<td><b>{gal_neve} ['.(strtoupper($_lang)).']:</b></td>							<td>								<input type="text" name="gal_cim_'.($_lang).'" value="'.($sor['gal_cim_'.($_lang).'']).'" class="typeText required" minlength="3" maxlength="128" />							</td>						</tr>';			}		}	}echo'						<tr>							<td class="cimke"><label for="gal_reurl"><b>{rovid_url}:</b></label></td>							<td>								<input type="text" id="gal_reurl" name="gal_reurl" value="'.($sor['gal_reurl']).'" class="typeReURL required" minlength="3" maxlength="255" reurl="galeria,'.(($_REQUEST['galid']>0)?($_REQUEST['galid']):(0)).','.(($_REQUEST['kipid']>0)?($_REQUEST['kipid']):(0)).'">								<div class="helpBox">{rovid_url_info}</div>							</td>						</tr>						<tr>							<td class="cimke"><label for="gal_h1"><b>{h1}</b></label></td>							<td>								<input type="text" id="gal_h1" name="gal_h1" value="'.($sor['gal_h1']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{h1_info}</div>							</td>						</tr>																		<tr>							<td class="cimke"><label for="gal_title"><b>{title}</b></label></td>							<td>								<input type="text" id="gal_title" name="gal_title" value="'.($sor['gal_title']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{title_info}</div>							</td>						</tr>						<tr>							<td class="cimke"><label for="gal_keyw"><b>{keywords}:</b></label></td>							<td>								<input type="text" id="gal_keyw" name="gal_keyw" value="'.($sor['gal_keyw']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{keywords_info}</div>							</td>						</tr>						<tr>							<td class="cimke"><label for="gal_desc"><b>{description}:</b></label></td>							<td>								<input type="text" id="gal_desc" name="gal_desc" value="'.($sor['gal_desc']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{description_info}</div>							</td>						</tr>						<tr>							<td><label for="gal_status"><b>{statusz}:</b></label></td>							<td>								<select id="gal_status" name="gal_status">									<option value="A"'.(($sor['gal_status']=='A')?(' SELECTED'):('')).'>{aktiv}</option>									<option value="I"'.(($sor['gal_status']=='I')?(' SELECTED'):('')).'>{inaktiv}</option>								</select>								<div class="helpBox">{statusz_info}</div>							</td>						</tr>						'.(KepUP::AdminForm('gal_{'.(($sor['gal_id'])?($sor['gal_id']):(0)).'}',$_ENV['CONF']['galMaxKep'],$_ENV['CONF']['galCimke'],$_ENV['CONF']['galSorsz'],$_ENV['CONF']['galAlbum'])).'						<tr>							<td colspan="2" align="center">								<input class="admin_btn" type="submit" value="Rögzít">							</td>						</tr>					</tbody>				</table>			</form>			<script type="text/javascript">				function FormControl(xa) {					var hibastr="";					var eNev = InputControl($("#gal_cim",$("#iForm")));					var eReurl = InputControl($("#gal_reurl",$("#iForm")),true);					var eH1 = InputControl($("#gal_h1",$("#iForm")));					var eTitle = InputControl($("#gal_title",$("#iForm")));					var eKeyw = InputControl($("#gal_keyw",$("#iForm")));					var eDesc = InputControl($("#gal_desc",$("#iForm")));					var eKep = (($("img[uploading=\'true\']").length>0)?(0):(1));										if(!eNev) { hibastr +="\n{gal_neve_error}"; }					if(!eReurl) { hibastr +="\n{rovid_url_error}!"; }					if(!eH1) { hibastr +="\n{h1_error}!"; }					if(!eTitle) { hibastr +="\n{title_error}!"; }					if(!eKeyw) { hibastr +="\n{keywords_error}!"; }					if(!eDesc) { hibastr +="\n{description_error}!"; }					if(!eKep) { hibastr +="\n{kepupload_error}!"; }										if(xa>0) {						if(hibastr!="") {							AddAlert("alert","{formhibak}:"+hibastr);							//alert("{formhibak}:"+hibastr);							return false;						} else { $("#MyBody").attr("edited",null); return true; }					} else { return false; }				}			</script>';?>