<?php /* Készítő: H.Tibor */ if(!($_ENV['SiteStart']) OR !($_ENV['USER']['ss_aid']>0)) { header('HTTP/1.0 404 Not Found',$replace=false,404); header('Location: /'); exit(); }	if($_REQUEST['rogzit'] AND strlen($_REQUEST['szp_cim'])>2) {		if($_REQUEST['szpid']>0) {			if(mysqli_query($_ENV['MYSQLI'],'				UPDATE `szpage` SET					`szp_gal`="'.(in_text($_REQUEST['szp_gal'])).'",					`szp_public`="'.(in_text($_REQUEST['szp_public'])).'",					`szp_cim`="'.(in_text($_REQUEST['szp_cim'])).'",					`szp_reurl`="'.(in_text($_REQUEST['szp_reurl'])).'",					`szp_status`="'.(in_text($_REQUEST['szp_status'])).'",					`szp_index`="'.(in_text($_REQUEST['szp_index'])).'",					`szp_h1`="'.(in_text($_REQUEST['szp_h1'])).'",					`szp_title`="'.(in_text($_REQUEST['szp_title'])).'",					`szp_keyw`="'.(in_text($_REQUEST['szp_keyw'])).'",					`szp_desc`="'.(in_text($_REQUEST['szp_desc'])).'",					`szp_rtext`="'.(in_html($_REQUEST['szp_rtext'])).'",					`szp_text`="'.(in_html($_REQUEST['szp_text'])).'"				WHERE `szp_id`="'.($_REQUEST['szpid']).'" LIMIT 1')) {					echo'<script type="text/javascript">AddAlert("ok","Oldal sikeresen módosítva!");</script>';				} else {					echo'<script type="text/javascript">AddAlert("no","Oldal módosítása sikertelen!");</script>';				}				if($_REQUEST['szpid']>0 AND $_REQUEST['p_id']>0 AND $_REQUEST['mode']=='kateg') {					mysqli_query($_ENV['MYSQLI'],'UPDATE `szmp` SET `szmp_status`="'.(in_text($_REQUEST['szp_status'])).'", `szmp_coll`="'.(in_text($_REQUEST['szmp_coll'])).'" WHERE `szmp_m_id`="'.($_REQUEST['p_id']).'" AND `szmp_p_id`="'.($_REQUEST['szpid']).'" LIMIT 1');				}		} else {			mysqli_query($_ENV['MYSQLI'],'				INSERT INTO `szpage`					( `szp_gal`, `szp_auid`, `szp_public`, `szp_status`, `szp_reurl`, `szp_cim`, `szp_index`, `szp_h1`, `szp_title`, `szp_keyw`, `szp_desc`, `szp_rtext`, `szp_text`, `szp_date` )				VALUES					(						"'.(in_text($_REQUEST['szp_gal'])).'",						"'.(in_text($_ENV['USER']['a_id'])).'",						"'.(in_text($_REQUEST['szp_public'])).'",						"'.(in_text($_REQUEST['szp_status'])).'",						"'.(in_text($_REQUEST['szp_reurl'])).'",						"'.(in_text($_REQUEST['szp_cim'])).'",						"'.(in_text($_REQUEST['szp_index'])).'",						"'.(in_text($_REQUEST['szp_h1'])).'",						"'.(in_text($_REQUEST['szp_title'])).'",						"'.(in_text($_REQUEST['szp_keyw'])).'",						"'.(in_text($_REQUEST['szp_desc'])).'",						"'.(in_html($_REQUEST['szp_rtext'])).'",						"'.(in_html($_REQUEST['szp_text'])).'",						now()					)');			$_REQUEST['szpid'] = mysqli_insert_id($_ENV['MYSQLI']);			if($_REQUEST['szpid']>0 AND $_REQUEST['p_id']>0 AND $_REQUEST['mode']=='kateg') {				$con = mysqli_query($_ENV['MYSQLI'],'SELECT max(`szmp_sorsz`) AS `sorsz` FROM `szmp` WHERE `szmp_m_id`="'.($_REQUEST['p_id']).'"');				if($sor=mysqli_fetch_array($con,MYSQLI_ASSOC)) { $sorsz = $sor['sorsz']+1; } unSet($sor); unSet($con);				mysqli_query($_ENV['MYSQLI'],'INSERT INTO `szmp` ( `szmp_m_id`, `szmp_p_id`, `szmp_status`, `szmp_coll`, `szmp_sorsz` ) VALUES ( "'.($_REQUEST['p_id']).'", "'.($_REQUEST['szpid']).'", "'.($_REQUEST['szp_status']).'", "'.($_REQUEST['szmp_coll']).'", "'.($sorsz).'" )');			}			if($_REQUEST['szpid']>0) {				echo'<script type="text/javascript">AddAlert("ok","Oldal sikeresen létrehozva!");</script>';			} else {				echo'<script type="text/javascript">AddAlert("ok","Oldal létrehozása meghiúsult!");</script>';			}		}		if($_REQUEST['szpid']>0) {			$con = mysqli_query($_ENV['MYSQLI'],'SELECT `ru_id` FROM `reurl` WHERE `ru_modul`="'.($_ENV['SITE']['MODUL']).'" AND `ru_elem_id`="szp_{'.($_REQUEST['szpid']).'}" LIMIT 1');			if(mysqli_num_rows($con)>0) {				mysqli_query($_ENV['MYSQLI'],'					UPDATE `reurl` SET						`ru_reurl`="'.(in_text($_REQUEST['szp_reurl'])).'",						`ru_index`="'.(in_text($_REQUEST['szp_index'])).'",						`ru_status`="'.(in_text($_REQUEST['szp_status'])).'",						`ru_h1`="'.(in_text($_REQUEST['szp_h1'])).'",						`ru_title`="'.(in_text($_REQUEST['szp_title'])).'",						`ru_keyw`="'.(in_text($_REQUEST['szp_keyw'])).'",						`ru_desc`="'.(in_text($_REQUEST['szp_desc'])).'",						`ru_date`=now()					WHERE `ru_modul`="'.($_ENV['SITE']['MODUL']).'" AND `ru_elem_id`="szp_{'.($_REQUEST['szpid']).'}" LIMIT 1');			} else {				mysqli_query($_ENV['MYSQLI'],'					INSERT INTO `reurl`						( `ru_modul`, `ru_elem_id`, `ru_reurl`, `ru_index`, `ru_status`, `ru_h1`, `ru_title`, `ru_keyw`, `ru_desc`, `ru_date` )					VALUES						(							"'.($_ENV['SITE']['MODUL']).'",							"szp_{'.($_REQUEST['szpid']).'}",							"'.(in_text($_REQUEST['szp_reurl'])).'",							"'.(in_text($_REQUEST['szp_index'])).'",							"'.(in_text($_REQUEST['szp_status'])).'",							"'.(in_text($_REQUEST['szp_h1'])).'",							"'.(in_text($_REQUEST['szp_title'])).'",							"'.(in_text($_REQUEST['szp_keyw'])).'",							"'.(in_text($_REQUEST['szp_desc'])).'",							now()						)');			}		}		print(mysqli_error($_ENV['MYSQLI']));	}	if($_REQUEST['szpid']>0) {		$con = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `szpage` LEFT JOIN `szmp` ON `szmp_p_id`=`szp_id` AND `szmp_m_id`="'.($_REQUEST['p_id']).'" WHERE `szp_id`="'.($_REQUEST['szpid']).'" LIMIT 1');		$sor = mysqli_fetch_array($con,MYSQLI_ASSOC);		echo'			<h1 class="cim">'.($sor['szp_cim']).' {szp_oldal_szerkesztese}!</h1>';	} else {		echo'			<h1 class="cim">{szp_oldal_szerkesztese_cim}!</h1>';	}		if($_REQUEST['p_id']>0 AND $_REQUEST['mode']=='kateg') {		xPozicio($_REQUEST['p_id'],$_REQUEST['oldal'],$_REQUEST['mode']);	} else {		echo'			<div class="pozicio"><a href="?oldal='.($oldal).'&amp;mode='.($mode).'">{menu_szmenu_pages}</a> &#187;</div>';	}	echo'			<a class="new_link" href="?oldal='.($_REQUEST['oldal']).'&amp;mode='.($_REQUEST['mode']).'&amp;p_id='.($_REQUEST['p_id']).'&amp;level='.($_REQUEST['level']).'">&#171; {vissza}</a><br/><br/>';	echo'			<form action="?oldal='.($_REQUEST['oldal']).'" method="post" name="iForm" id="iForm" onsubmit="return FormControl(1);">				<div style="text-align:right;"><input class="admin_btn save_btn" name="smbt" type="submit" value="'.(($_REQUEST['szpid']>0)?('{modosit}'):('{felvisz}')).'" style="float:none;margin: -25px 0px 10px;" onclick="$(\'#MyBody\').attr(\'edited\',null);" /></div>				<input type="hidden" name="rogzit" value="1"/>				<input type="hidden" name="mode" value="'.($_REQUEST['mode']).'" />				<input type="hidden" name="p_id" value="'.($_REQUEST['p_id']).'" />				<input type="hidden" name="level" value="'.($_REQUEST['level']).'" />				<input type="hidden" name="xMode" value="'.($_REQUEST['xMode']).'" />				<input type="hidden" name="szpid" value="'.($_REQUEST['szpid']).'" />				<input type="hidden" id="FixReurl" value="'.(($_REQUEST['szpid']>0)?(1):(0)).'" />				<table class="table" width="100%" cellspacing="0" cellpadding="3" border="0">					<tbody>						<tr class="fejlec"> <th colspan="2"> {szp_oldal_szerkesztese} </th> </tr>						<tr>							<td class="cimke" style="width:150px;"><label for="szp_cim"><b>{cim}:</b></label></td>							<td>								<input type="text" id="szp_cim" name="szp_cim" value="'.($sor['szp_cim']).'" class="typeText required" minlength="3" maxlength="128" copyReurl="szp_reurl" />								<div class="helpBox">{cim_info}</div>							</td>						</tr>						<tr>							<td class="cimke"><label for="szp_reurl"><b>{rovid_url}:</b></label></td>							<td>								<input type="text" id="szp_reurl" name="szp_reurl" value="'.($sor['szp_reurl']).'" class="typeReURL required" minlength="3" maxlength="255" reurl="szpage,'.(($_REQUEST['szpid']>0)?($_REQUEST['szpid']):(0)).',0" />								<div class="helpBox">{rovid_url_info}</div>							</td>						</tr>						<tr>							<td class="cimke"><label for="szp_h1"><b>{h1}</b></label></td>							<td>								<input type="text" id="szp_h1" name="szp_h1" value="'.($sor['szp_h1']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{h1_info}</div>							</td>						</tr>						<tr>							<td class="cimke"><label for="szp_title"><b>{title}</b></label></td>							<td>								<input type="text" id="szp_title" name="szp_title" value="'.($sor['szp_title']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{title_info}</div>							</td>						</tr>						<tr>							<td class="cimke"><label for="szp_keyw"><b>{keywords}:</b></label></td>							<td>								<input type="text" id="szp_keyw" name="szp_keyw" value="'.($sor['szp_keyw']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{keywords_info}</div>							</td>						</tr>						<tr>							<td class="cimke"><label for="szp_desc"><b>{description}:</b></label></td>							<td>								<input type="text" id="szp_desc" name="szp_desc" value="'.($sor['szp_desc']).'" class="typeText" minlength="3" maxlength="255" />								<div class="helpBox">{description_info}</div>							</td>						</tr>						<tr>							<td><label for="szp_index"><b>{indexel}:</b></label></td>							<td>								<select id="szp_index" name="szp_index">									<option value="I"'.(($sor['szp_index']=='I')?(' SELECTED'):('')).'>Igen</option>									<option value="N"'.(($sor['szp_index']=='N')?(' SELECTED'):('')).'>Nem</option>								</select>								<div class="helpBox">{indexel_info}</div>							</td>						</tr>						<tr>							<td><label for="szp_status"><b>{statusz}:</b></label></td>							<td>								<select id="szp_status" name="szp_status">									<option value="A"'.(($sor['szp_status']=='A')?(' SELECTED'):('')).'>{aktiv}</option>									<option value="I"'.(($sor['szp_status']=='I')?(' SELECTED'):('')).'>{inaktiv}</option>								</select>								<div class="helpBox">{statusz_info}</div>							</td>						</tr>					'.(($_REQUEST['p_id']>0 AND $_REQUEST['mode']=='kateg')?('						<tr>							<td><label for="szmp_coll"><b>Hasáb:</b></label></td>							<td>								<select id="szmp_coll" name="szmp_coll">									<option value="0"'.(($sor['szmp_coll']=='0')?(' SELECTED'):('')).'>Bal oldalt</option>									<option value="1"'.(($sor['szmp_coll']=='1')?(' SELECTED'):('')).'>Jobb oldalt</option>								</select>							</td>						</tr>'):('')).'					'.((is_array($_ENV['WEBUSERS']) AND $_ENV['SzmenuRegKot'])?('						<tr>							<td><label for="szp_public"><b>{szp_regkot}:</b></label></td>							<td>								<select id="szp_public" name="szp_public">									<option value="N"'.(($sor['szp_public']=='N')?(' SELECTED'):('')).'>{nem}</option>									<option value="I"'.(($sor['szp_public']=='I')?(' SELECTED'):('')).'>{igen}</option>								</select>								<div class="helpBox">{szp_regkot_info}</div>							</td>						</tr>'):('<tr style="display:none;"><td colspan="2"><input type="hidden" name="szp_public" value="N"/></td></tr>'));	if($_ENV['SzmenuGalTarsit']) {		echo'						<tr id="tr_gal">							<td class="cimke"><label for="szp_gal"><b>{szp_galeria}:</b></label></td>							<td>								<select name="szp_gal" id="szp_gal">									<option value=""> -- {szp_galeriak} -- </option>';		$gcon = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `galeria` WHERE `gal_status`="A" ORDER BY `gal_sorsz`');		while($gsor=mysqli_fetch_array($gcon,MYSQLI_ASSOC)) {			echo'									<option value="'.($gsor['gal_id']).'"'.(($gsor['gal_id']==$sor['szp_gal'])?(' SELECTED'):('')).'> '.($gsor['gal_cim']).' </option>';		}		echo'								</select>							</td>						</tr>';	}if($_ENV['szmSzerkRovOldal']) {echo'						<tr>							<td colspan="2" style="padding-top:10px;">								<label for="szp_rtext'.$_ENV['TIME'].'"><b>{szp_rtext}:</b></label>								'.(htmlTextaInsert('szp_rtext'.$_ENV['TIME'])).'								'.(HTML_TEXTAREA('szp_rtext'.$_ENV['TIME'],false,false)).'								<div class="helpBox">{szp_text_info}</div><br/>								<textarea class="szp_rtext'.$_ENV['TIME'].' tinymce" id="szp_rtext'.$_ENV['TIME'].'" name="szp_rtext" cols="10" rows="10" style="min-width:'.($_ENV['CONF']['sysTextaWidth']).'px; min-height:'.($_ENV['CONF']['sysTextaHeight']).'px;">'.($sor['szp_rtext']).'</textarea>							</td>						</tr>';}echo'						<tr>							<td colspan="2" style="padding-top:10px;">								<label for="szp_text'.$_ENV['TIME'].'"><b>{szp_text}:</b></label>								'.(htmlTextaInsert('szp_text'.$_ENV['TIME'])).'								'.(HTML_TEXTAREA('szp_text'.$_ENV['TIME'],false,false)).'								<div class="helpBox">{szp_text_info}</div><br/>								<textarea class="szp_text'.$_ENV['TIME'].' tinymce" id="szp_text'.$_ENV['TIME'].'" name="szp_text" cols="10" rows="10" style="min-width:'.($_ENV['CONF']['sysTextaWidth']).'px; min-height:'.($_ENV['CONF']['sysTextaHeight']).'px;">'.($sor['szp_text']).'</textarea>							</td>						</tr>						<tr class="fejlec"><td colspan="2" style="text-align: center;"><input class="admin_btn" name="smbt" type="submit" value="'.(($_REQUEST['szpid']>0)?('{modosit}'):('{felvisz}')).'" onclick="$(\'#MyBody\').attr(\'edited\',null);" /></td></tr>					</tbody>				</table>			</form>			<script type="text/javascript">				function FormControl(xa) {					var hibastr="";										var eCim = InputControl($("#szp_cim",$("#iForm")));					var eReurl = InputControl($("#szp_reurl",$("#iForm")),true);					var eH1 = InputControl($("#szp_h1",$("#iForm")));					var eTitle = InputControl($("#szp_title",$("#iForm")));					var eKeyw = InputControl($("#szp_keyw",$("#iForm")));					var eDesc = InputControl($("#szp_desc",$("#iForm")));										if(!eCim) { hibastr +="\n{cim_error}"; }					if(!eReurl) { hibastr +="\n{rovid_url_error}"; }					if(!eH1) { hibastr +="\n{h1_error}"; }					if(!eTitle) { hibastr +="\n{title_error}"; }					if(!eKeyw) { hibastr +="\n{keywords_error}"; }					if(!eDesc) { hibastr +="\n{description_error}"; }										if(xa>0) {						if(hibastr!="") {							AddAlert("alert","{formhibak}:"+hibastr);							return false;						} else { $("#MyBody").attr("edited",null); return true; }					} else { return false; }				}				onReadyDoc(function() { setTimeout("FormControl(0);", 10); });			</script>';?>