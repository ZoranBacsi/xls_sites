<?php /* Készítő: H.Tibor */ if(!($_ENV['SiteStart']) OR !($_ENV['USER']['ss_aid']>0)) { header('HTTP/1.0 404 Not Found',$replace=false,404); header('Location: /'); exit(); }	/* Menű törlése */	if($_REQUEST['hMode']=='szmDel') {		$con = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `szmenu` WHERE `szm_id`="'.($_REQUEST['szmid']).'" LIMIT 1');		if($sor=mysqli_fetch_array($con,MYSQLI_ASSOC)) { $del_sorsz = $sor['szm_sorsz']; } unSet($sor); unSet($con);		if(szmDel($_REQUEST['szmid'])) {			mysqli_query($_ENV['MYSQLI'],'UPDATE `szmenu` SET `szm_sorsz`=( `szm_sorsz` - 1 ) WHERE `szm_k_id`="'.($_REQUEST['p_id']).'" AND `szm_sorsz`>"'.($del_sorsz).'" ORDER BY `szm_sorsz`');			echo'<script type="text/javascript">AddAlert("ok","Menüpont törölve!");</script>';		} else {			echo'<script type="text/javascript">AddAlert("no","Menüpont törölése sikertelen!");</script>';		}	}		/* Sorba rendezés rögzítése */	if($_POST['KategSorrendRogzites']) {		for($a=0;$a<count($_REQUEST['szm_id']);$a++) {			mysqli_query($_ENV['MYSQLI'],'UPDATE `szmenu` SET `szm_sorsz`="'.($_REQUEST['szm_sorsz'][$a]).'" WHERE `szm_id`="'.($_REQUEST['szm_id'][$a]).'" LIMIT 1');		}		if(!mysqli_error($_ENV['MYSQLI'])) {			echo'<script type="text/javascript">AddAlert("ok","Menüpontok sorrendje rögzítve!");</script>';		} else {			echo'<script type="text/javascript">AddAlert("no","Menüpontok sorrendjének rögzítése sikerteln!");</script>';		}	}		/* Tartalom társít/kivesz */	if($_REQUEST['hMode']=='szmTarsBe' AND $_REQUEST['szpid']>0) {		$sorsz = 1;		$con = mysqli_query($_ENV['MYSQLI'],'SELECT max(`szmp_sorsz`) AS `sorsz` FROM `szmp` WHERE `szmp_m_id`="'.($_REQUEST['p_id']).'"');		if($sor=mysqli_fetch_array($con,MYSQLI_ASSOC)) { $sorsz = $sor['sorsz']+1; } unSet($sor); unSet($con);		mysqli_query($_ENV['MYSQLI'],'INSERT INTO `szmp` ( `szmp_m_id`, `szmp_p_id`, `szmp_status`, `szmp_sorsz` ) VALUES ( "'.($_REQUEST['p_id']).'", "'.($_REQUEST['szpid']).'", "A", "'.($sorsz).'" )');	}	if($_REQUEST['hMode']=='szmTarsKi' AND $_REQUEST['szpid']>0) {		mysqli_query($_ENV['MYSQLI'],'DELETE FROM `szmp` WHERE `szmp_m_id`="'.($_REQUEST['p_id']).'" AND `szmp_p_id`="'.($_REQUEST['szpid']).'" ');	}	/* Tartalom sorba rendezés rögzítése */	if($_POST['TartalomSorrendRogzites']) {		for($a=0;$a<count($_REQUEST['szmp_id']);$a++) {			mysqli_query($_ENV['MYSQLI'],'UPDATE `szmp` SET `szmp_sorsz`="'.($_REQUEST['szmp_sorsz'][$a]).'" WHERE `szmp_id`="'.($_REQUEST['szmp_id'][$a]).'" LIMIT 1');		}		if(!mysqli_error($_ENV['MYSQLI'])) {			echo'<script type="text/javascript">AddAlert("ok","Tartalmak sorrendje rögzítve!");</script>';		} else {			echo'<script type="text/javascript">AddAlert("no","Tartalmak sorrendjének rögzítése sikerteln!");</script>';		}	}	/* Tartalom törlése */	if($_REQUEST['hMode']=='szpDel') {		$con = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `szpage` WHERE `szp_id`="'.($_REQUEST['szpid']).'" LIMIT 1');		if($sor=mysqli_fetch_array($con,MYSQLI_ASSOC)) { $del_sorsz = $sor['szp_sorsz']; } unSet($sor); unSet($con);		if(szpDel($_REQUEST['szpid'])) {			echo'<script type="text/javascript">AddAlert("ok","Tartalom törölve!");</script>';		} else {			echo'<script type="text/javascript">AddAlert("no","Tartalom törölése sikertelen!");</script>';		}	}	/* Kategória listása */	echo'		<h1 class="cim">{szm_szmenu_cim}</h1>';	xPozicio($_REQUEST['p_id'],$_REQUEST['oldal'],$_REQUEST['mode']);			$acon = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `szmenu` WHERE `szm_id`="'.($_REQUEST['p_id']).'" LIMIT 1');		$amenu = mysqli_fetch_array($acon,MYSQLI_ASSOC);	/* Menüpontok listázása */	$con = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `szmenu` WHERE `szm_k_id`="'.($_REQUEST['p_id']).'" ORDER BY `szm_sorsz`');	if( ( $_REQUEST['level'] == 1 AND ( !$_ENV['SzmenuMaxFirstLevel'] OR mysqli_num_rows($con)<$_ENV['SzmenuMaxFirstLevel'] ) ) OR ( $_REQUEST['level']>1 AND $_REQUEST['level']<=$_ENV['SzmenuMaxLevel'] ) ) {			echo'					<a class="new_link" href="?oldal='.($_REQUEST['oldal']).'&amp;mode='.($_REQUEST['mode']).'&amp;p_id='.($_REQUEST['p_id']).'&amp;level='.($_REQUEST['level']).'&amp;xMode=szmNew">{szm_uj_menupont}...</a><br/>';	}	$_kategDarab = mysqli_num_rows($con);	if($_kategDarab>0) {		echo'<br/>		<h3>{szm_menupontok_cim}:</h3>		<form action="?oldal='.($_REQUEST['oldal']).'&amp;mode='.($_REQUEST['mode']).'&amp;p_id='.($_REQUEST['p_id']).'&amp;level='.($_REQUEST['level']).'" onsubmit="return noAlert();" name="kategoriak" method="post">			<input type="hidden" name="KategSorrendRogzites" value="1" />			<table class="table" width="100%" cellspacing="0" cellpadding="3" border="0">				<tbody>					<tr class="fejlec">						<th width="25">#</th>						<th width="40">St.</th>						<th>{szm_link}</th>						<th width="200">{cim}</th>						<th width="40">{sorrend}</th>						<th class="admin_btn">{modosit}</th>						<th class="admin_btn">{torol}</th>					</tr>';		$n=0;		while($sor=mysqli_fetch_array($con,MYSQLI_ASSOC)) { $n++;			echo'					<tr>						<td>'.($n).'.</td>						<td>'.(($sor['szm_status']=='A')?('<font color="#0000CC">{aktiv}</font>'):('<font color="#CC0000">{inaktiv}</font>')).'</td>						<td>'.(($_ENV['SzmenuMaxLevel']>$_REQUEST['level'] OR ($_ENV['szmSzerkCikkOldal'] AND $_ENV['SzmenuMaxLevel']>=$_REQUEST['level']))?('<a href="?oldal='.($_REQUEST['oldal']).'&amp;mode='.($_REQUEST['mode']).'&amp;p_id='.($sor['szm_id']).'&amp;level='.($sor['szm_level']+1).'">'.(out_icons($sor['szm_link'])).'</a>'):(out_icons($sor['szm_link']))).'</td>						<td>'.(($sor['szm_mod']=='M')?($sor['szm_cim']):($sor['szm_href'])).'</td>						<td>							<input type="hidden" name="szm_id['.($n-1).']" value="'.($sor['szm_id']).'"/>							<select class="szm_sorsz" name="szm_sorsz['.($n-1).']" onfocus="$(this).attr(\'oldValue\',$(this).val());" onchange="var thisValue=$(this).val(); zSorszam(thisValue,$(this).attr(\'oldValue\'),\'szm_sorsz\'); this.value=thisValue; $(this).attr(\'oldValue\',$(this).val());" style="width:75px;">'.(xSorrend($_kategDarab,$n)).'</select>						</td>						<td>							<input class="admin_btn" type="button" value="{modosit}" onclick="LoadPage(\'?oldal='.($_REQUEST['oldal']).'&mode='.($_REQUEST['mode']).'&p_id='.($_REQUEST['p_id']).'&level='.($_REQUEST['level']).'&szmid='.($sor['szm_id']).'&xMode=szmMod\');"/>						</td>						<td>							<input class="admin_btn" type="button" value="{torol}" onclick="if('.(									(mysqli_num_rows(mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `szmenu` WHERE `szm_k_id`="'.($sor['szm_id']).'" LIMIT 1'))>0)									?('strtoupper(prompt(\'{szm_torol_alkateg_confirm}\'))==\'OK\'')									:('confirm(\'{szm_torol_confirm}\')')									).') { LoadPage(\'?oldal='.($_REQUEST['oldal']).'&mode='.($_REQUEST['mode']).'&p_id='.($_REQUEST['p_id']).'&level='.($_REQUEST['level']).'&szmid='.($sor['szm_id']).'&hMode=szmDel\'); } else { return false; }" />						</td>					</tr>';		}		echo'					<tr class="fejlec"><td colspan="4">&nbsp;</td><td><input class="admin_btn" type="submit" name="KategSorrendRogzites" value="{rogzit}" style="width:75px;"/></td><td colspan="2">&nbsp;</td></tr>				</tbody>			</table>		</form>';		}	unSet($con); unSet($sor);	if( ( $_REQUEST['level']>1 AND $_REQUEST['level']<=$_ENV['SzmenuMaxLevel'] ) OR $_kategDarab>0) {		echo'<hr/>';	}if($_ENV['szmSzerkCikkOldal'] AND $_REQUEST['level']>1 AND ($amenu['szm_mod']=='N' OR $amenu['szm_mod']=='M')) {/* Tartalmak listázása */	$con = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `szpage` INNER JOIN `szmp` ON `szmp_p_id`=`szp_id` WHERE `szmp_m_id`="'.($_REQUEST['p_id']).'" AND `szmp_p_id`=`szp_id` ORDER BY `szmp_sorsz`');	echo'		<a class="new_link" href="?oldal='.($_REQUEST['oldal']).'&amp;mode='.($_REQUEST['mode']).'&amp;p_id='.($_REQUEST['p_id']).'&amp;level='.($_REQUEST['level']).'&amp;xMode=szpNew">{szmp_uj_tartalom}...</a><br/>';	$_pageDarab = mysqli_num_rows($con);	if($_pageDarab>0) {		echo'<br/>		<h3>{szmp_tartalom_cim}:</h3>		<form action="?oldal='.($_REQUEST['oldal']).'&amp;mode='.($_REQUEST['mode']).'&amp;p_id='.($_REQUEST['p_id']).'&amp;level='.($_REQUEST['level']).'" onsubmit="return noAlert();" name="tartalmak" method="post">			<input type="hidden" name="TartalomSorrendRogzites" value="1" />			<table class="table" width="100%" cellspacing="0" cellpadding="3" border="0">				<tbody>					<tr class="fejlec">						<th width="25">#</th>						<th width="40">St.</th>						<th>{szm_link}</th>						<th width="60">Hasább</th>						<th width="40">{sorrend}</th>						<th class="admin_btn">{modosit}</th>						<th class="admin_btn">{torol}</th>						<th class="admin_btn">{kivesz}</th>					</tr>';		$n=0;		while($sor=mysqli_fetch_array($con,MYSQLI_ASSOC)) { $n++;			echo'					<tr>						<td>'.($n).'.</td>						<td>'.(($sor['szp_status']=='A')?('<font color="#0000CC">{aktiv}</font>'):('<font color="#CC0000">{inaktiv}</font>')).'</td>						<td>'.(out_icons($sor['szp_cim'])).'</td>						<td>'.(($sor['szmp_coll']=='0')?('Bal oldalt'):('Jobb oldalt')).'</td>						<td>							<input type="hidden" name="szmp_id['.($n-1).']" value="'.($sor['szmp_id']).'"/>							<select class="szmp_sorsz" name="szmp_sorsz['.($n-1).']" onfocus="$(this).attr(\'oldValue\',$(this).val());" onchange="var thisValue=$(this).val(); zSorszam(thisValue,$(this).attr(\'oldValue\'),\'szmp_sorsz\'); this.value=thisValue; $(this).attr(\'oldValue\',$(this).val());" style="width:75px;">'.(xSorrend($_pageDarab,$n)).'</select>						</td>						<td>							<input class="admin_btn" type="button" value="{modosit}" onclick="LoadPage(\'?oldal='.($_REQUEST['oldal']).'&mode='.($_REQUEST['mode']).'&p_id='.($_REQUEST['p_id']).'&level='.($_REQUEST['level']).'&szpid='.($sor['szp_id']).'&xMode=szpMod\');"/>						</td>						<td>							<input class="admin_btn" type="button" value="{torol}" onclick="if(confirm(\'{szmp_torol_confirm}\')) { LoadPage(\'?oldal='.($_REQUEST['oldal']).'&mode='.($_REQUEST['mode']).'&p_id='.($_REQUEST['p_id']).'&level='.($_REQUEST['level']).'&szpid='.($sor['szp_id']).'&hMode=szpDel\'); } else { return false; }" />						</td>						<td>							<input class="admin_btn" type="button" value="{kivesz}" onclick="LoadPage(\'?oldal='.($_REQUEST['oldal']).'&mode='.($_REQUEST['mode']).'&p_id='.($_REQUEST['p_id']).'&level='.($_REQUEST['level']).'&szpid='.($sor['szp_id']).'&hMode=szmTarsKi\');"/>						</td>					</tr>';		}		echo'					<tr class="fejlec"><td colspan="5">&nbsp;</td><td><input class="admin_btn" type="submit" name="TartalomSorrendRogzites" value="{rogzit}" style="width:75px;"/></td><td colspan="2">&nbsp;</td></tr>				</tbody>			</table>		</form>';	}	echo'<hr/>';		/* Társítható Tartalmak listázása */	$con = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `szpage` LEFT JOIN `szmp` ON `szmp_p_id`=`szp_id` AND `szmp_m_id` = "'.($_REQUEST['p_id']).'" WHERE `szmp_id` IS NULL ORDER BY `szp_date` DESC');	$_pageDarab = mysqli_num_rows($con);	if($_pageDarab>0) {		echo'<br/>		<h3>{szmp_tartalom_tarsit_cim}:</h3>			<table class="table" width="100%" cellspacing="0" cellpadding="3" border="0">				<tbody>					<tr class="fejlec">						<th width="25">#</th>						<th>{szm_link}</th>						<th class="admin_btn">{modosit}</th>						<th class="admin_btn">{torol}</th>						<th class="admin_btn">{tarsit}</th>					</tr>';		$n=0;		while($sor=mysqli_fetch_array($con,MYSQLI_ASSOC)) { $n++;			echo'					<tr>						<td>'.($n).'.</td>						<td>'.(out_icons($sor['szp_cim'])).'</td>						<td>							<input class="admin_btn" type="button" value="{modosit}" onclick="LoadPage(\'?oldal='.($_REQUEST['oldal']).'&mode='.($_REQUEST['mode']).'&p_id='.($_REQUEST['p_id']).'&level='.($_REQUEST['level']).'&szpid='.($sor['szp_id']).'&xMode=szpMod\');"/>						</td>						<td>							<input class="admin_btn" type="button" value="{torol}" onclick="if(confirm(\'{szmp_torol_confirm}\')) { LoadPage(\'?oldal='.($_REQUEST['oldal']).'&mode='.($_REQUEST['mode']).'&p_id='.($_REQUEST['p_id']).'&level='.($_REQUEST['level']).'&szpid='.($sor['szp_id']).'&hMode=szpDel\'); } else { return false; }" />						</td>						<td>							<input class="admin_btn" type="button" value="{tarsit}" onclick="LoadPage(\'?oldal='.($_REQUEST['oldal']).'&mode='.($_REQUEST['mode']).'&p_id='.($_REQUEST['p_id']).'&level='.($_REQUEST['level']).'&szpid='.($sor['szp_id']).'&hMode=szmTarsBe\');"/>						</td>					</tr>';		}		echo'				</tbody>			</table>';	}	echo'<hr/>';}?>