<?php /* Készítő: H.Tibor */ if(!($_ENV['SiteStart']) OR !($_ENV['USER']['ss_aid']>0)) { header('HTTP/1.0 404 Not Found',$replace=false,404); header('Location: /'); exit(); }	/* Menű törlése */	if($_REQUEST['hMode']=='del' AND is_numeric($_REQUEST['galid'])) {		$kat_con = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `galeria` WHERE `gal_id`="'.($_REQUEST['galid']).'" LIMIT 1');		$sor = mysqli_fetch_array($kat_con,MYSQLI_ASSOC);		mysqli_query($_ENV['MYSQLI'],'DELETE FROM `galeria` WHERE `gal_id`="'.($_REQUEST['galid']).'" LIMIT 1');		mysqli_query($_ENV['MYSQLI'],'DELETE FROM `reurl` WHERE `ru_modul`="'.($_ENV['SITE']['MODUL']).'" AND `ru_elem_id`="gal_{'.($_REQUEST['galid']).'}" LIMIT 1');		mysqli_query($_ENV['MYSQLI'],'UPDATE `galeria` SET `gal_sorsz`=( `gal_sorsz` - 1 ) WHERE `gal_p_id`="'.($sor['gal_p_id']).'" AND `gal_sorsz` > "'.($sor['gal_sorsz']).'"');		$kep_con = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `kepek` WHERE `kep_mid`="gal_{'.($_REQUEST['galid']).'}"');		if(mysqli_num_rows($kep_con)) {			while($row = mysqli_fetch_array($kep_con,MYSQLI_ASSOC)) {				if(is_file(DOCUMENT_ROOT.$row['kep_eredeti'])) { unlink(DOCUMENT_ROOT.$row['kep_eredeti']); }				if(is_file(DOCUMENT_ROOT.$row['kep_nagy'])) { unlink(DOCUMENT_ROOT.$row['kep_nagy']); }				if(is_file(DOCUMENT_ROOT.$row['kep_kozepes'])) { unlink(DOCUMENT_ROOT.$row['kep_kozepes']); }				if(is_file(DOCUMENT_ROOT.$row['kep_kicsi'])) { unlink(DOCUMENT_ROOT.$row['kep_kicsi']); }				mysqli_query($_ENV['MYSQLI'],'DELETE FROM `kepek` WHERE `kep_id`="'.($row['kep_id']).'" LIMIT 1');			}			echo'<script type="text/javascript">AddAlert("ok","Album törölve!");</script>';		} else {			echo'<script type="text/javascript">AddAlert("no","Album törölése sikertelen!");</script>';		}	}	/* Sorba rendezés rögzítése */	if($_REQUEST['hMode']=='sorszam') {		for($a=0;$a<count($_REQUEST['galid']);$a++) {			mysqli_query($_ENV['MYSQLI'],'UPDATE `galeria` SET `gal_sorsz`="'.($_REQUEST['gal_sorsz'][$a]).'" WHERE `gal_id`="'.($_REQUEST['galid'][$a]).'" LIMIT 1');		}		if(!mysqli_error($_ENV['MYSQLI'])) {			echo'<script type="text/javascript">AddAlert("ok","Albumok sorrendje rögzítve!");</script>';		} else {			echo'<script type="text/javascript">AddAlert("no","Albumok sorrendjének rögzítése sikerteln!");</script>';		}	}	$con = mysqli_query($_ENV['MYSQLI'],'SELECT * FROM `galeria` WHERE `gal_p_id`="'.($_REQUEST['kipid']).'" ORDER BY `gal_sorsz`'); $n=0;	$galfent = mysqli_num_rows($con);	/* Albumok listása */	echo'			<h1>{gal_galeriak_cim}</h1>			<form action="?oldal='.($_REQUEST['oldal']).'&amp;kipid='.($_REQUEST['kipid']).'&amp;level='.($_REQUEST['level']).'" onsubmit="return noAlert();" method="POST" name="iForm" id="iForm">				<input type="hidden" name="hMode" value="sorszam">				<div class="pozicio"><a class="new_link" href="?oldal='.($_REQUEST['oldal']).'">{gal_galeria_poz} &#187;</a> '.(status($_REQUEST['kipid'])).'</div>				'.(($_ENV['CONF']['galMax']>$galfent)?('<a class="new_link" href="?oldal='.($_REQUEST['oldal']).'&amp;kipid='.($_REQUEST['kipid']).'&amp;level='.($_REQUEST['level']).'&amp;xMode=edit">{gal_uj_album}...</a>'):('')).'<br/><br/>				<table class="table" width="100%" cellspacing="0" cellpadding="3" align="center" border="0">					<tbody>						<tr class="fejlec">							<th class="urlap_ids">#</th>							<th class="urlap_status">St.</th>							<th>Név</th>							<th class="urlap_button">{sorrend}</th>							<th class="urlap_button">{modosit}</th>							<th class="urlap_button">{torol}</th>						</tr>';	while($sor=mysqli_fetch_array($con,MYSQLI_ASSOC)) { $n++;		echo'						<tr>							<td>'.($n).'</td>							<td>'.(($sor['gal_status']=='A')?('<font color="#0000CC">{aktiv}</font>'):('<font color="#CC0000">{inaktiv}</font>')).'</td>							<td>'.(out_text($sor['gal_cim'])).'</td>							<td>								<input type="hidden" name="galid['.($n-1).']" value="'.($sor['gal_id']).'"/>								<select class="gal_sorsz" name="gal_sorsz['.($n-1).']" onfocus="$(this).attr(\'oldValue\',$(this).val());" onchange="var thisValue=$(this).val(); zSorszam(thisValue,$(this).attr(\'oldValue\'),\'gal_sorsz\'); this.value=thisValue; $(this).attr(\'oldValue\',$(this).val());" style="width:75px;">'.(xSorrend($galfent,$n)).'</select>							</td>							<td align="center">								<input class="admin_btn" type="button" value="{modosit}" onclick="LoadPage(\'?oldal='.($_REQUEST['oldal']).'&amp;kipid='.($_REQUEST['kipid']).'&amp;level='.($_REQUEST['level']).'&amp;galid='.($sor['gal_id']).'&amp;xMode=edit\');"></td>							<td align="center"><input class="admin_btn" type="button" value="{torol}" onclick="if(confirm(\'{gal_torol_confirm}\')) { LoadPage(\'?oldal='.($_REQUEST['oldal']).'&amp;kipid='.($_REQUEST['kipid']).'&amp;level='.($_REQUEST['level']).'&amp;galid='.($sor['gal_id']).'&amp;hMode=del\'); }"></td>						</tr>';	}	echo'					<tr>						<td colspan="3">&nbsp;</td>						<td><input class="admin_btn" type="submit" name="smb" value="{rogzit}"></td>						<td colspan="2">&nbsp;</td>					</tr>					</tobdy>				</table>			</form>';?>